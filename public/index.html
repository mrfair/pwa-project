<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <title>GoPoo</title>
    <link rel="icon" href="/image/launcher-icon-2x.png" type="image/png" />
    <script>
      var db, latnow, lngnow;
    </script>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Vue -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.min.js"></script>

    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

    <!-- Moment Local.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/locale/th.js"></script>

    <!-- Jquery Cookies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/4.1.3/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/4.1.3/firebase-auth.js"></script>
    <script defer src="/__/firebase/4.1.3/firebase-database.js"></script>
    <script defer src="/__/firebase/4.1.3/firebase-messaging.js"></script>
    <script defer src="/__/firebase/4.1.3/firebase-storage.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>

    <!-- Disable tap highlight on IE -->
    <meta name="msapplication-tap-highlight" content="no">

    <!-- Web Application Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="GoPoo">
    <meta name="theme-color" content="#b7732a">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#b7732a">
    <meta name="apple-mobile-web-app-title" content="GoPoo">
    <meta name="apple-mobile-web-app-status-bar-style" content="#b7732a">

    <!-- Tile icon for Win8 -->
    <meta name="msapplication-TileColor" content="#b7732a">
    <meta name="msapplication-navbutton-color" content="#b7732a">

    <!-- Icon homesceen -->
    <link rel="icon" sizes="192x192" href="image/launcher-icon-4x.png">
    <link rel="icon" sizes="128x128" href="image/launcher-icon-128.png">
    <link rel="apple-touch-icon" sizes="128x128" href="image/launcher-icon-128.png">
    <link rel="apple-touch-icon-precomposed" sizes="128x128" href="image/launcher-icon-128.png">

    <!-- GoPoo script & style -->
    <link rel="stylesheet" type="text/css" href="/style.css?v=1.0.16">
    <script type="text/javascript" src="/gopoo.js?v=1.0.77"></script>
    <script type="text/javascript" src="/gmap.js?v=1.0.77"></script>
    <!-- END -->
  </head>
  <body>
    <div id="map" align="center">
      <img src="/image/launcher-icon-512.png" class="img-responsive" id="grass" />
      <h1>
        โหลดแผนที่ไม่ได้<br />ทุ่งหญ้าคือทางออกที่ดี
      </h1>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <div class="modal-title media" id="modal-detail-title">GoPoo</div>
          </div>
          <div class="modal-body" id="modal-detail-body">
          </div>
          <div class="modal-footer">
            <div class="tl">
              คุณคิดเห็นอย่างไร?
            </div>
            <textarea class="form-control mt5" id="mycomment" placeholder="แสดงความคิดเห็น"></textarea>
            <div class="mt10">
              <button type="button" class="btn btn-primary fr mt5" id="bt_comment_add">แสดงความเห็น</button>
              <div class="tl" id="container_rateYo" data-rating="5">
                ให้คะแนน
                <span id="rateYo"></span>
              </div>
            </div>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- Modal Add -->
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title media">
              <div align="center">
                <img src="/image/shockpoo.png" />
              </div>
              <h4>คุณค้นพบจุด GoPoo อย่างนั้นหรือ?</h4>
              <p>
                สถานที่แห่งนี้อาจช่วยเพื่อนมนุษย์ให้หลุดพ้นจากความทุกข์ทรมานในยามฉุกเฉินได้ คุณเป็นผู้ค้นพบคนแรก โปรดตั้งชื่อให้กับสถานที่แห่งนี้
              </p>
            </div>
          </div>
          <div class="modal-body">
            <p>
              ชื่อสถานที่ <input type="text" id="namegopoo" maxlength="40" placeholder="ชื่อสถานที่ Gopoo" class="form-control" />
            </p>
            <p>
              คำบรรยายสถานที่ <textarea id="detailgopoo" class="form-control" rows="3" maxlength="150" placeholder="คำบรรยายสถานที่"></textarea>
            </p>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning fr mt5" id="bt_goopoo_add">เพิ่มจุด GoPoo</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- Modal Setting -->
    <div id="settingModal" class="modal fade" role="dialog">
      <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">ตั้งค่าการค้นหา</h4>
          </div>
          <div class="modal-body">
            <ul id="list_setting" class="lsn"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Welcome -->
    <div id="welcomeModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header" align="center">
            <img src="/image/logorb.png" height="50" />
            <h3>สวัสดี!</h3>
            <h4 id="welcome_text_caption"></h4>
          </div>
          <div class="modal-body">
            <p class="bg-warning">
              <h5><strong><u>Tips</u></strong></h5>
              หากคุณอยู่ในสถานที่ที่ไม่คุ้นเคยและกำลังมองหาจุด GoPoo ลองแตะที่แผนที่แล้วเลือก Find GoPoo ดูนะ
            </p>
              <table class="table">
                <tr>
                  <th width="30">
                    ภาพ
                  </th>
                  <th>
                    คำแนะนำ
                  </th>
                </tr>
                <tr>
                  <td>
                    <img src="/image/myicon.png" width="24" />
                  </td>
                  <td>
                    ตำแหน่งปัจจุบันของคุณ ปรากฏอยู่บนแผนที่
                  </td>
                </tr>
                <tr>
                  <td>
                    <img src="/image/getmylocation.png" width="24" />
                  </td>
                  <td>
                    ปุ่มกดเพื่อเรียกตำแหน่งปัจจุบันของคุณพร้อมทั้งค้นหาจุด GoPoo ที่อยู่โดยรอบ ปรากฎอยู่ด้านล่างของหน้าจอ
                  </td>
                </tr>
                <tr>
                  <td>
                    <img src="/image/mapicon22.png" width="24" />
                  </td>
                  <td>
                    จุด GoPoo (ห้องน้ำ) ปรากฏอยู่บนแผนที่ <u>คลิก</u>ได้ เพื่อดูรายละเอียดและแสดงความคิดเห็นของคุณต่อจุด GoPoo นี้
                  </td>
                </tr>

                <tr>
                  <td>
                    <img src="/image/mapicon.png" width="24" />
                  </td>
                  <td>
                    จุด GoPoo (ห้องน้ำ) ที่มีผู้ค้นพบและบันทึกไว้ ปรากฏอยู่บนแผนที่ <u>คลิก</u>ได้ เพื่อดูรายละเอียดและแสดงความคิดเห็นของคุณต่อจุด GoPoo นี้
                  </td>
                </tr>
                <tr>
                  <td>
                    <img src="/image/addgopoo.png" width="24" />
                  </td>
                  <td>
                    Add GoPoo ปุ่มเพิ่มจุด GoPoo (ห้องน้ำ) ปรากฏขึ้นหลังจากคลิกในตำแหน่งว่างๆ บนแผนที่ ใช้ในกรณีที่คุณต้องการสร้างจุด GoPoo ที่ยังไม่มีบนแผนที่
                  </td>
                </tr>
                <tr>
                  <td>
                    <img src="/image/findgopoo.png" width="24" />
                  </td>
                  <td>
                    Find GoPoo ปุ่มค้นหาจุด GoPoo (ห้องน้ำ) รอบๆ บริเวณตำแหน่งที่คลิก ปรากฏขึ้นหลังจากคลิกในตำแหน่งว่างๆ บนแผนที่
                  </td>
                </tr>
                <tr>
                  <td>
                    <span class="glyphicon glyphicon-edit f25"></span>
                  </td>
                  <td>
                    ปุ่มแสดงความคิดเห็นบางส่วนของจุด GoPoo โดยรอบ ปรากฎอยู่ด้านล่างซ้ายของหน้าจอ สามารถคลิกปุ่ม <span class="glyphicon glyphicon-search"></span> เพื่อตามไปดูความคิดเห็นอื่นๆ ของจุด GooPoo นั้นได้
                  </td>
                </tr>
                <tr>
                  <td>
                    <span class="glyphicon glyphicon-cog f25"></span>
                  </td>
                  <td>
                    ปุ่มตั้งค่าประเภทการค้นหาจุด GoPoo โดยรอบ ปรากฎอยู่ด้านล่างซ้ายของหน้าจอ
                  </td>
                </tr>
                <tr>
                  <td colspan="2">
                    <h5>ระดับความพึงพอใจจากต่ำไปสูง(ซ้าย>ขวา)</h5>
                    <div align="center">
                      <img src="/image/lv1.png" width="34" />
                      <img src="/image/lv2.png" width="34" />
                      <img src="/image/lv3.png" width="34" />
                      <img src="/image/lv4.png" width="34" />
                      <img src="/image/lv5.png" width="34" />
                    </div>
                    <br />
                    <p>
                      คุณสามารถเรียกหน้าต่างข้อแนะนำได้จากรูปโลโก้ GoPoo ด้านขวาล่างของหน้าจอ
                    </p>
                  </td>
                </tr>
              </table>
          </div>
          <div class="modal-footer">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td align="left">
                  <p>
                    <label><input type="checkbox" id="welcome_hide" /> ไม่ต้องแสดงอีก</label>
                  </p>
                </td>
                <td align="right">
                  <button type="button" class="btn btn-warning fr mt5 bt_welcome_toggle">โอเค</button>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Nav -->
    <nav class="navbar navbar-default navbar-fixed-bottom">
      <div class="container-fluid">
          <div class="row">
            <div class="col-xs-4">
              <div class="dropup dib">
                <span class="glyphicon glyphicon-edit" id="bt_comment_last" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
                <ul class="dropdown-menu" aria-labelledby="bt_comment_last">
                  <li class="comment_list_header">
                    <h4>ความคิดเห็นตามจุด GoPoo</h4>
                  </li>
                  <li id="comment_list" class="tc">
                    <h5>ไม่มีความเห็น</h5>
                  </li>
                </ul>
              </div>
              <div class="dropup dib ml10">
                <span class="glyphicon glyphicon-cog" id="bt_setting_search"></span>
              </div>
            </div>
            <div class="col-xs-4 tc">
              <a href="#" id="bt_locatin_now" class="glyphicon  glyphicon-screenshot"></a>
            </div>
            <div class="col-xs-4">
              <img src="image/logorb.png" class="logorb bt_welcome_toggle" />
            </div>
        </div>
      </div>
    </nav>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCHqGWXvCatTzwwvOFBfEQDTNybWL-CpNI&libraries=places&hl=th&callback=initMap">
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

        try {
          let app = firebase.app();
          let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          console.log( `Firebase SDK loaded with ${features.join(', ')}` );

          var ref = firebase.database().ref();

          ref.on("value", function( snapshot ) {
             db = snapshot.val();
             db_check = "1";
             $("#bt_comment_last").click( function() {
               $("#comment_list").html(function() {
                 var review = {};
                 $.each( db, function( k, v ) {
                   if( v.review ) {
                     $.each( v.review, function( k1, v1 ) {
                       review[k1] = {
                         id: v.id,
                         lat: v.lat,
                         lng: v.lng,
                         review : v1.comment,
                         rating: v1.rating
                       };
                     });
                   }
                 });

                 /** Check place_cache to array **/
                 var pc = [];
                 $.each( place_cache, function( k, v ) {
                   pc.push( k );
                 });

                 var r = '';
                 if( Object.keys(review).length > 0 ) {
                   var review_i = 0;
                   for( var i in review ) {
                     var v = review[i];
                     if( v && ( $.inArray( v.id, pc ) >= 0 && review_i < 8 ) ) {
                      review_i++;

                      r += '<div class="comment_list_block"><span class="container_comment_list_level">' + gp.lv( v.rating ) + '</span> <span class="ellipsis comment_list_text">' + v.review + '</span> <span class="glyphicon glyphicon-search mt5 fr bt_comment_go" data-id="' + v.id +'"></span></div>';
                     }
                   }
                 } else {
                   r = '<h5>ไม่มีความคิดเห็น</h5>';
                 }
                 return r;
               }) ;

               $( ".bt_comment_go" ).each( function() {
                 $( this ).unbind( "click" ).bind( "click", function() {
                   var id = $( this ).attr("data-id");
                   gp.modal_detail( place_cache[id], id );
                 });
               })
             });

             place_human( db );

          }, function (error) {
             console.log("Error: " + error.code);
          });

        } catch (e) {
          console.error(e);
          console.log( 'Error loading the Firebase SDK, check the console.' );
        }
      });

      if('serviceWorker' in navigator) {
        navigator.serviceWorker
                 .register('/sw.js?v=1.0.14')
                 .then(function() { console.log("Service Worker Registered"); });
      } else {
        console.log("ERROR : Service Worker Not Registerd");
      }


    </script>
  </body>
</html>
